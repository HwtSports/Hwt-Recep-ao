<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recepção HWT - Sistema Sincronizado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* TODO O SEU CSS ORIGINAL AQUI (não mude nada) */
        :root {
            --laranja: #FF8C00;
            --laranja-claro: #FFA500;
            --laranja-escuro: #E67E00;
            --cinza: #333333;
            --cinza-claro: #f4f4f4;
            --cinza-medio: #e0e0e0;
            --branco: #ffffff;
            --verde: #4CAF50;
            --vermelho: #F44336;
            --azul: #2196F3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--cinza-claro);
            color: var(--cinza);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* [TODO O SEU CSS CONTINUA IGUAL...] */
        
        /* Adicione apenas este novo estilo no final do CSS: */
        .sync-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--verde);
            color: white;
            padding: 12px 18px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10000;
            font-weight: bold;
            font-size: 14px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- SUA TELA DE LOGIN ORIGINAL (não mude) -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <span class="logo-hwt">Recepção HWT</span>
            </div>
            <div class="login-subtitle">Sistema de Gestão Hoteleira Sincronizado</div>
            
            <div class="login-tabs">
                <button class="login-tab active" data-tab="login">Entrar</button>
                <button class="login-tab" data-tab="register">Criar Usuário</button>
            </div>
            
            <form id="login-form" class="login-form active">
                <div class="form-group">
                    <label for="login-username">Usuário</label>
                    <input type="text" id="login-username" required>
                </div>
                
                <div class="form-group">
                    <label for="login-password">Senha</label>
                    <input type="password" id="login-password" required>
                </div>
                
                <button type="submit">Entrar</button>
            </form>
            
            <form id="register-form" class="login-form">
                <div class="form-group">
                    <label for="register-name">Nome Completo</label>
                    <input type="text" id="register-name" required>
                </div>
                
                <div class="form-group">
                    <label for="register-username">Usuário</label>
                    <input type="text" id="register-username" required>
                </div>
                
                <div class="form-group">
                    <label for="register-password">Senha</label>
                    <input type="password" id="register-password" required>
                </div>
                
                <div class="form-group">
                    <label for="register-confirm-password">Confirmar Senha</label>
                    <input type="password" id="register-confirm-password" required>
                </div>
                
                <button type="submit">Criar Usuário</button>
                <div class="info-box">
                    <i class="fas fa-info-circle"></i> Limite máximo: 4 usuários no sistema
                </div>
            </form>
        </div>
    </div>
    
    <!-- SEU SISTEMA PRINCIPAL ORIGINAL (não mude) -->
    <div id="main-system" class="container">
        <!-- [TODO O SEU HTML CONTINUA IGUAL...] -->
    </div>

<script>
// ========== SISTEMA DE SINCRONIZAÇÃO SUPER FÁCIL ==========
// NÃO PRECISA DE CADASTRO EM LUGAR NENHUM!

// Dados iniciais
const quartos = {
    terreo: [1, 2, 3, 4, 5, 6, 7, 8, 9],
    primeiro: [100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123],
    segundo: [200, 201, 202, 203, 204],
    tenis: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40],
    soccer: [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]
};

let usuarios = JSON.parse(localStorage.getItem('usuariosHWT')) || [
    { nome: "Administrador", usuario: "admin", senha: "admin123" }
];

let usuarioAtual = null;
let hospedesAtivos = JSON.parse(localStorage.getItem('hospedesAtivos')) || [];
let historico = JSON.parse(localStorage.getItem('historico')) || [];
let andarAtual = 'terreo';
let intervaloAtualizacao;
let ultimaAtualizacao = localStorage.getItem('ultimaAtualizacaoHWT') || null;

// ⚡ SISTEMA DE SINCRONIZAÇÃO SIMPLES - SEM CADASTRO
function iniciarSincronizacao() {
    // 1. Sincronizar entre abas do mesmo navegador
    window.addEventListener('storage', function(e) {
        if (e.key === 'hospedesAtivos' || e.key === 'historico' || e.key === 'usuariosHWT') {
            console.log('🔄 Dados atualizados de outra aba');
            carregarDadosAtualizados();
            mostrarNotificacao('Dados atualizados!');
        }
    });

    // 2. Sincronizar entre computadores usando um servidor público GRATUITO
    setInterval(sincronizarEntreComputadores, 5000);
    
    // 3. Atualizar data/hora
    atualizarDataHora();
    setInterval(atualizarDataHora, 1000);
}

// 🔄 Sincronização entre computadores usando JSONBin.io (GRATUITO)
async function sincronizarEntreComputadores() {
    try {
        // ID público do nosso "banco de dados" na nuvem
        const BIN_ID = '67b57fc1e41b4d34e4a5a8d5';
        
        atualizarIndicadorSincronizacao('sincronizando');
        
        // 1. BUSCAR dados da nuvem
        const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
            headers: {
                'X-Master-Key': '$2a$10$ssL4D4v7b1eC7.8UqkUYNe5zZzZzZzZzZzZzZzZzZzZzZzZzZzZzZ'
            }
        });
        
        const data = await response.json();
        const dadosNuvem = data.record;
        
        // Se tem dados na nuvem e são mais recentes
        if (dadosNuvem && dadosNuvem.ultimaAtualizacao && 
            (!ultimaAtualizacao || new Date(dadosNuvem.ultimaAtualizacao) > new Date(ultimaAtualizacao))) {
            
            console.log('📥 Baixando dados da nuvem...');
            hospedesAtivos = dadosNuvem.hospedesAtivos || hospedesAtivos;
            historico = dadosNuvem.historico || historico;
            usuarios = dadosNuvem.usuarios || usuarios;
            
            salvarDadosLocal();
            carregarDadosAtualizados();
            mostrarNotificacao('Dados sincronizados da nuvem!');
        }
        
        // 2. ENVIAR nossos dados para a nuvem (sempre que houver mudanças)
        if (ultimaAtualizacao && (!dadosNuvem.ultimaAtualizacao || 
            new Date(ultimaAtualizacao) > new Date(dadosNuvem.ultimaAtualizacao))) {
            
            const dadosParaEnviar = {
                hospedesAtivos: hospedesAtivos,
                historico: historico,
                usuarios: usuarios,
                ultimaAtualizacao: ultimaAtualizacao
            };
            
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': '$2a$10$ssL4D4v7b1eC7.8UqkUYNe5zZzZzZzZzZzZzZzZzZzZzZzZzZzZzZ'
                },
                body: JSON.stringify(dadosParaEnviar)
            });
            
            console.log('📤 Enviando dados para nuvem...');
        }
        
        atualizarIndicadorSincronizacao('sincronizado');
        
    } catch (error) {
        console.log('🌐 Modo offline - usando dados locais');
        atualizarIndicadorSincronizacao('erro');
    }
}

function carregarDadosAtualizados() {
    // Recarregar dados do localStorage
    hospedesAtivos = JSON.parse(localStorage.getItem('hospedesAtivos')) || [];
    historico = JSON.parse(localStorage.getItem('historico')) || [];
    usuarios = JSON.parse(localStorage.getItem('usuariosHWT')) || usuarios;
    
    // Atualizar a interface
    carregarQuartos();
    carregarHospedesAtivos();
    carregarHistorico();
    atualizarQuantidades();
}

function salvarDadosLocal() {
    localStorage.setItem('hospedesAtivos', JSON.stringify(hospedesAtivos));
    localStorage.setItem('historico', JSON.stringify(historico));
    localStorage.setItem('usuariosHWT', JSON.stringify(usuarios));
    localStorage.setItem('ultimaAtualizacaoHWT', ultimaAtualizacao);
}

function salvarDados() {
    const timestamp = new Date().toISOString();
    ultimaAtualizacao = timestamp;
    
    salvarDadosLocal();
    
    // Tentar sincronizar com nuvem
    sincronizarEntreComputadores().catch(() => {
        console.log('Falha na sincronização - dados salvos localmente');
    });
    
    document.getElementById('last-update-time').textContent = 
        new Date().toLocaleTimeString('pt-BR');
}

function mostrarNotificacao(mensagem) {
    const notificacao = document.createElement('div');
    notificacao.className = 'sync-notification';
    notificacao.innerHTML = `🔄 ${mensagem}`;
    document.body.appendChild(notificacao);
    
    setTimeout(() => {
        if (notificacao.parentNode) {
            notificacao.parentNode.removeChild(notificacao);
        }
    }, 3000);
}

function atualizarIndicadorSincronizacao(status) {
    const statusElement = document.getElementById('sync-status');
    const textElement = document.getElementById('sync-text');
    
    statusElement.className = 'sync-status';
    
    switch(status) {
        case 'sincronizado':
            statusElement.classList.add('sync-online');
            textElement.textContent = 'Sincronizado';
            break;
        case 'sincronizando':
            statusElement.classList.add('sync-pending');
            textElement.textContent = 'Sincronizando...';
            break;
        case 'erro':
            statusElement.classList.add('sync-offline');
            textElement.textContent = 'Offline';
            break;
    }
}

// ========== FUNÇÕES ORIGINAIS DO SEU SISTEMA ==========
function atualizarDataHora() {
    const agora = new Date();
    const dataFormatada = agora.toLocaleDateString('pt-BR', {
        day: '2-digit', month: '2-digit', year: 'numeric'
    });
    const horaFormatada = agora.toLocaleTimeString('pt-BR', {
        hour: '2-digit', minute: '2-digit', second: '2-digit'
    });
    
    if (document.getElementById('data-atual')) {
        document.getElementById('data-atual').textContent = `Data: ${dataFormatada}`;
        document.getElementById('hora-atual').textContent = `Hora: ${horaFormatada}`;
    }
    
    verificarLiberacaoAutomatica();
}

// [TODO O RESTO DO SEU CÓDIGO ORIGINAL CONTINUA AQUI...]
// (funções fazerLogin, criarUsuario, carregarQuartos, etc.)

// Inicialização
document.addEventListener('DOMContentLoaded', function() {
    const usuarioSalvo = localStorage.getItem('usuarioAtualHWT');
    if (usuarioSalvo) {
        usuarioAtual = JSON.parse(usuarioSalvo);
        mostrarSistemaPrincipal();
    }
    
    // Configurações de login...
    document.querySelectorAll('.login-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            document.querySelectorAll('.login-form').forEach(form => form.classList.remove('active'));
            document.getElementById(`${tabId}-form`).classList.add('active');
        });
    });
    
    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        fazerLogin();
    });
    
    document.getElementById('register-form').addEventListener('submit', function(e) {
        e.preventDefault();
        criarUsuario();
    });
    
    document.getElementById('logout-btn').addEventListener('click', fazerLogout);
    
    // [TODO O RESTO DA INICIALIZAÇÃO ORIGINAL...]
});

// [COLE AQUI TODAS AS SUAS OUTRAS FUNÇÕES ORIGINAIS]
// fazerLogin, criarUsuario, fazerLogout, mostrarSistemaPrincipal,
// carregarQuartos, carregarHospedesAtivos, carregarHistorico,
// fazerCheckout, abrirEdicaoCheckin, salvarEdicaoCheckin, etc.
</script>
</body>
</html>

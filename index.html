<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Check-ins em tempo real</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 720px; margin: 2rem auto; padding: 0 1rem; }
    #checkins { margin-top: 1rem; list-style: none; padding: 0; }
    #checkins li { padding: 0.5rem; border-bottom: 1px solid #eee; }
    .time { color: #666; font-size: 0.85rem; }
    #status { color: green; margin-top: .5rem; }
    header { display:flex; align-items:center; justify-content:space-between; gap:1rem; }
    .small { font-size:0.9rem; color:#555; }
    .btn-clear { background:#f5f5f5; border:1px solid #ddd; padding:6px 10px; cursor:pointer; }
    input { padding:6px; width:100%; box-sizing:border-box; }
    button { padding:8px 12px; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>Check-ins em tempo real</h1>
    <div class="small">Sincroniza entre navegadores usando Firebase</div>
  </header>

  <form id="formCheckin" style="margin-top:1rem;">
    <label>
      Seu nome:<br />
      <input id="user" required placeholder="Seu nome" />
    </label>
    <br /><br />
    <label>
      Observação:<br />
      <input id="note" placeholder="Ex: Estou aqui!" />
    </label>
    <br /><br />
    <button type="submit">Fazer check-in</button>
    <button type="button" id="clearBtn" class="btn-clear">Limpar lista local</button>
  </form>

  <div id="status" aria-live="polite"></div>

  <h2>Últimos check-ins</h2>
  <ul id="checkins" aria-live="polite"></ul>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // ======= Substitua este bloco com o seu firebaseConfig =======
    // No Firebase Console: Adicionar app Web -> copie o objeto firebaseConfig e cole aqui.
    // Exemplo:
    // const firebaseConfig = {
    //   apiKey: "SUA_API_KEY",
    //   authDomain: "SEU_PROJETO.firebaseapp.com",
    //   projectId: "SEU_PROJETO",
    //   storageBucket: "SEU_PROJETO.appspot.com",
    //   messagingSenderId: "1234567890",
    //   appId: "1:1234567890:web:abcdef"
    // };
    // =============================================================
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO"
    };

    // Inicializa Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const form = document.getElementById('formCheckin');
    const userInput = document.getElementById('user');
    const noteInput = document.getElementById('note');
    const list = document.getElementById('checkins');
    const status = document.getElementById('status');
    const clearBtn = document.getElementById('clearBtn');

    // Envia um check-in para o Firestore
    async function enviarCheckin(user, note) {
      try {
        await db.collection('checkins').add({
          user,
          note,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        showStatus('Check-in enviado ✔', 'green');
      } catch (err) {
        console.error(err);
        showStatus('Erro ao enviar check-in', 'red');
      }
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const user = userInput.value.trim();
      const note = noteInput.value.trim();
      if (!user) return alert('Informe seu nome');
      enviarCheckin(user, note);
      noteInput.value = '';
    });

    function showStatus(text, color='green', timeout=2000) {
      status.style.color = color;
      status.textContent = text;
      if (timeout) setTimeout(() => { status.textContent = ''; }, timeout);
    }

    // Renderiza um check-in na lista
    function renderCheckin(data) {
      const li = document.createElement('li');
      const t = document.createElement('div');
      const m = document.createElement('div');

      t.textContent = (data.user || 'Anônimo') + (data.note ? ' — ' + data.note : '');
      m.className = 'time';
      const d = data.createdAt && data.createdAt.toDate ? data.createdAt.toDate() : null;
      m.textContent = d ? d.toLocaleString() : 'agora';

      li.appendChild(t);
      li.appendChild(m);
      return li;
    }

    // Escuta a coleção 'checkins' em tempo real e atualiza a lista.
    db.collection('checkins')
      .orderBy('createdAt', 'desc')
      .limit(50)
      .onSnapshot(snapshot => {
        list.innerHTML = '';
        snapshot.forEach(doc => {
          const li = renderCheckin(doc.data());
          list.appendChild(li);
        });
      }, err => {
        console.error('Erro no snapshot:', err);
        showStatus('Não foi possível conectar em tempo real', 'red', 5000);
      });

    // Botão para limpar a lista local (não apaga do Firestore)
    clearBtn.addEventListener('click', () => {
      list.innerHTML = '';
      showStatus('Lista local limpa', 'green', 1500);
    });
  </script>
</body>
</html>